generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

enum BillingCycle {
  Monthly 
  Annual 
}

model Group {
  id         String      @id @default(cuid())
  name       String      @unique
  legalName  String 
  logo       Json 
  taxId      String 
  industry   String 
  address    String
  city       String
  province   String
  postalCode String
  country    String 
  email      String 
  phone      String 
  website    String?
  subscriptionId String?
  billingCycle   BillingCycle?
  entities   Entity[]
  groupRoles GroupRole[]
  users      User[]
}

model Entity {
  id          String     @id @default(cuid())
  name        String     @unique
  groupId     String
  address     String?
  city        String?
  country     String?
  currency    String?
  email       String?    @unique
  legalName   String?
  phoneNumber String?
  postalCode  String?
  state       String?
  taxId       String?
  website     String?
  yearEnd     String?
  customer    Customer[]
  group       Group      @relation(fields: [groupId], references: [id])
  invoice     Invoice[]
  users       User[]
  receipt     Receipt[]
  vendor      vendor[]
  expenses    Expenses[]
  bills       Bills[]
  items       Items[]
  collection  Collection[]
  asset       Asset[]
  account     Account[]
  journal     Journal[]
  budget      Budget[]
  employee    Employee[]
  leave       Leave[]
  attendance  AttendanceLog[]
  paymentReceived PaymentReceived[]
  @@index([name, taxId, email])
}

model User {
  id            String     @id @default(cuid())
  email         String     @unique
  firstName     String?
  lastName      String?
  password      String?
  image         Json?
  provider      String?
  providerId    String?
  emailVerified DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  groupRoleId   String?
  systemRole    systemRole @default(user)
  groupId       String?
  entityId      String?
  entity        Entity?    @relation(fields: [entityId], references: [id])
  group         Group?     @relation(fields: [groupId], references: [id])
  groupRole     GroupRole? @relation(fields: [groupRoleId], references: [id])
  auditLogs     AuditLog[]

  @@unique([provider, providerId])
}

model GroupRole {
  id          String       @id @default(cuid())
  name        String
  groupId     String
  group       Group        @relation(fields: [groupId], references: [id])
  users       User[]
  permissions Permission[] @relation("GroupRoleToPermission")

  @@unique([name, groupId])
}

model Customer {
  id           String    @id @default(cuid())
  type         String
  name         String
  email        String    @unique
  phoneNumber  String
  companyName  String
  country      String?
  address      String
  city         String
  state        String
  postalCode   String
  paymentTerms String
  creditLimit  String
  note         String?
  entityId     String
  isActive     Boolean   @default(true)
  entity       Entity    @relation(fields: [entityId], references: [id], onDelete: Cascade)
  invoice      Invoice[]
  receipt      Receipt[]
  createdAt    DateTime @default(now())

  @@index([email, name])
}

model Invoice {
  id            String        @id @default(cuid())
  customerId    String
  entityId      String
  invoiceNumber String        @unique
  invoiceDate   DateTime
  dueDate       DateTime
  paymentTerms  String
  currency      String
  items         String[]
  total         Int
  notes         String?
  status        InvoiceStatus @default(Pending)
  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  entity        Entity        @relation(fields: [entityId], references: [id], onDelete: Cascade)
  paymentReceived PaymentReceived[]

  @@index([invoiceNumber, customerId, currency])
}

model vendor {
  id            String @id @default(cuid())
  name          String
  type          String
  displayName   String
  taxId         String 
  website       String? 
  companyName   String
  jobTitle      String
  email         String
  phone         String
  city          String
  province      String
  postalCode    String 
  country       String 
  paymentTerms  String 
  currency      String 
  accountNumber String 
  creditLimit   String
  expenseAccount String
  bankName       String 
  accountName    String 
  entityId      String
  entity        Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  routingNumber  String?
  internalNote   String?
  status         vendorStatus @default(Active)
  createdAt      DateTime @default(now())
  bills          Bills[]
  @@unique([email, phone])
  @@index([type, email])
}

model PaymentReceived {
  id                String  @id @default(cuid())
  invoiceId         String
  amount            Int
  total             Int 
  invoice           Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  paidAt            DateTime 
  paymentMethod     String 
  depositTo         String 
  reference         String 
  note              String?
  status            PaymentReceivedStatus @default(Pending)
  entityId          String 
  entity            Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt         DateTime @default(now())

  @@index([invoiceId])
}

model Expenses {
  id            String @id @default(cuid())
  date          DateTime 
  reference     String 
  supplier       String 
  category      String
  paymentMethod PaymentMethod
  account       String 
  amount        Int
  tax           String
  description   String?
  tags          String[]
  attachment    Json?
  entityId      String
  entity        Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())
  @@index([reference, category])
}

model Bills {
  id            String @id @default(cuid())
  billDate          DateTime 
  billNumber        String?
  vendorId          String 
  vendor            vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  dueDate           DateTime
  poNumber          String?
  paymentTerms      String 
  items             String[]
  total             Int 
  category          String  
  notes             String?
  attachment        Json?
  status            BillStatus @default(unpaid)
  entityId          String
  entity            Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt          DateTime @default(now())
  paymentRecord      PaymentRecord[]
  @@index([billDate, category])
}

model PaymentRecord {
  id                String @id @default(uuid())
  billId            String 
  bill              Bills @relation(fields: [billId], references: [id], onDelete: Cascade)
  paidAt            DateTime 
  paymentMethod     PaymentMethod 
  reference         String 
  account           String 
  note              String?
  status            paymentRecordStatus @default(cleared)
  createdAt         DateTime @default(now())
  
  @@index([billId])
}

model Receipt {
  id                    String @id @default(cuid())   
  customerId            String
  receiptNumber         String @default("123456789")
  customer              Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  date                    DateTime
  entityId                String
  entity                  Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  paymentMethod           PaymentMethod 
  items                   String[]
  total                   Int
  status                  ReceiptStatus @default(Void)
  createdAt               DateTime @default(now())
  @@index([date])
}

model Items {
  id            String @id @default(cuid())
  name          String 
  category      String 
  sku           String?
  unit          String? 
  description   String
  sellingPrice  Int?
  costPrice     Int?
  rate          Int?
  taxable       Boolean @default(false)
  currentStock  Int?
  lowStock      Int?
  type          ItemsType @default(product)
  entityId      String 
  entity        Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())

  @@index([entityId, type])
}

model Collection {
  id               String @id @default(cuid())
  name             String 
  slug             String 
  image            Json? 
  description      String 
  visibility       Boolean @default(false)
  featured         Boolean @default(false)
  entityId         String 
  entity           Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())

  @@index([entityId])
}

// order .

model Asset {
  id            String @id @default(cuid())
  name          String
  type          String 
  department    String 
  assigned      String 
  description   String 
  purchaseDate  DateTime
  purchaseCost  Int
  currentValue  Int 
  expiryDate    DateTime 
  trackDepreciation Boolean @default(false)
  depreciationMethod String 
  years             Int 
  salvageValue      Int 
  activeAsset       Boolean @default(false)
  status           AssetStatus @default(in_use)
  entityId         String 
  entity           Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())

  @@index([id, entityId])
}

model Account {
  id            String  @id @default(cuid())
  name          String 
  code          String 
  category      String 
  subCategory   String 
  description   String 
  type          String 
  balance       Int @default(0)
  credit        Int?
  debit         Int?
  date          DateTime?
  budget        Budget[]
  entityId      String 
  entity        Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())

  @@index([id, entityId])
}

model Journal {
  id               String @id @default(cuid())
  description      String 
  date             DateTime
  lines            Json
  reference        String
  entityId         String 
  entity           Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())

  @@index([id, entityId])
}

model Budget {
  id            String  @id @default(cuid())
  name          String 
  amount        Int 
  periodType   String 
  month        String
  fiscalYear    String
  note          String?
  accountId     String 
  account       Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  entityId      String
  entity        Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())
  @@index([entityId])
}

model Employee {
  id              String  @id @default(cuid())
  firstName       String
  lastName        String  
  email           String @unique
  phoneNumber     String
  dateOfBirth    DateTime 
  employeeId      String @unique
  department      String
  position        String
  profileImage   Json?
  employmentType String
  dateOfHire     DateTime
  reportingManager String
  anualLeave       Int
  salary          Int
  allowances      Int
  status          EmployeeStatus @default(Active)
  perFrequency    String
  currency        String
  bankName        String 
  acountType      String 
  accountNumber   String 
  routingNumber   String
  addressInfo     Json?
  emergencyContact Json?
  note             String?
  asdraft           Boolean @default(false)
  attendance       Attendance[]
  leave            Leave[]
  entityId        String
  entity          Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())

  @@index([employeeId, email, entityId])
}

model AttendanceLog {
  id               String       @id @default(cuid())
  date             DateTime
  entityId         String
  entity           Entity       @relation(fields: [entityId], references: [id], onDelete: Cascade)
  attendances      Attendance[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  @@unique([date, entityId])
  @@index([date, entityId])
}

model Attendance {
  id               String        @id @default(cuid())
  employeeId       String
  employee         Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  attendanceLogId  String
  attendanceLog    AttendanceLog @relation(fields: [attendanceLogId], references: [id], onDelete: Cascade)
  status           String
  checkInTime      DateTime?
  checkOutTime     DateTime?
  notes            String?
  asdraft          Boolean       @default(false)
  entityId         String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([employeeId, entityId])
  @@index([attendanceLogId])
}

model Leave {
  id              String @id @default(cuid())
  employeeId      String 
  employee        Employee @relation(fields: [employeeId], references: [id])
  leaveType       String 
  days            Int 
  startDate       DateTime
  endDate         DateTime
  reason          String 
  entityId        String
  entity          Entity @relation(fields: [entityId], references: [id])
  status          LeaveStatus @default(Pending)
  contact         String 
  emergencyContact String 
  createdAt       DateTime @default(now())

  @@index([employeeId, status])
}
model Permission {
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  groupRoles  GroupRole[] @relation("GroupRoleToPermission")
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String  // or clerkId, auth0 id, etc.
  user       User     @relation(fields: [userId], references: [id])
  action     String   // "CREATE_JOURNAL", "UPDATE_ENTITY", "DELETE_INVOICE", ...
  ipAddress String?   @map("ip_address")
  device    String?
  location  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

enum systemRole {
  superadmin
  admin
  user
}

enum LeaveStatus {
  Pending 
  Approved
}

enum PaymentReceivedStatus {
  Paid
  Pending
  Partial
}

enum EmployeeStatus {
  Active
  Inactive
  On_Leave
}

enum AssetStatus {
  in_use
  in_storage
}

enum paymentRecordStatus {
  pending 
  cleared
}

enum ItemsType {
  product 
  service
}

enum BillStatus {
  paid 
  unpaid
}

enum vendorStatus {
  Active
  Inactive
}
enum PaymentMethod {
  Cash
  Card
  Bank_Transfer
  Mobile_Money
  Check
  Debit_Card
  Credit_Card
  ACH 
  Wire_Transfer
}
enum ReceiptStatus {
  Completed 
  Void
}
enum InvoiceStatus {
  Overdue
  Paid
  Draft
  Sent
  Pending
}
