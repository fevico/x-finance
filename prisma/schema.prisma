generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model Group {
  id                String            @id @default(cuid())
  name              String            @unique
  legalName         String
  logo              Json
  taxId             String
  industry          String
  address           String
  city              String
  province          String
  postalCode        String
  country           String
  email             String
  phone             String
  website           String?
  subscriptionId    String?
  billingCycle      BillingCycle?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @default(now()) @updatedAt
  entities          Entity[]
  groupRoles        GroupRole[]
  users             User[]
  accountCategories AccountCategory[]
}

model Entity {
  id              String            @id @default(cuid())
  name            String            @unique
  groupId         String
  address         String?
  city            String?
  country         String?
  currency        String?
  email           String?           @unique
  legalName       String?
  companyName     String?
  phoneNumber     String?
  postalCode      String?
  logo            Json?
  state           String?
  taxId           String?
  website         String?
  yearEnd         String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now()) @updatedAt
  account         Account[]
  asset           Asset[]
  attendance      AttendanceLog[]
  bills           Bills[]
  budget          Budget[]
  collection      Collection[]
  customer        Customer[]
  employee        Employee[]
  group           Group             @relation(fields: [groupId], references: [id])
  expenses        Expenses[]
  invoice         Invoice[]
  items           Items[]
  journal         Journal[]
  leave           Leave[]
  paymentReceived PaymentReceived[]
  receipt         Receipt[]
  users           User[]
  vendor          vendor[]
  paymentMade     PaymentMade[]
  bankAccounts    BankAccount[]     @relation("BankAccounts")

  @@index([name, taxId, email])
}

model User {
  id            String     @id @default(cuid())
  email         String     @unique
  firstName     String?
  lastName      String?
  password      String?
  image         Json?
  provider      String?
  providerId    String?
  emailVerified DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  groupRoleId   String?
  systemRole    systemRole @default(user)
  groupId       String?
  entityId      String?
  auditLogs     AuditLog[]
  entity        Entity?    @relation(fields: [entityId], references: [id])
  group         Group?     @relation(fields: [groupId], references: [id])
  groupRole     GroupRole? @relation(fields: [groupRoleId], references: [id])

  @@unique([provider, providerId])
}

model GroupRole {
  id          String       @id @default(cuid())
  name        String
  groupId     String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @default(now()) @updatedAt
  group       Group        @relation(fields: [groupId], references: [id])
  users       User[]
  permissions Permission[] @relation("GroupRoleToPermission")

  @@unique([name, groupId])
}

model Customer {
  id           String    @id @default(cuid())
  type         String
  name         String
  email        String    @unique
  phoneNumber  String
  companyName  String
  address      String
  city         String
  state        String
  postalCode   String
  paymentTerms String
  creditLimit  String
  note         String?
  entityId     String
  isActive     Boolean   @default(true)
  country      String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  entity       Entity    @relation(fields: [entityId], references: [id], onDelete: Cascade)
  invoice      Invoice[]
  receipt      Receipt[]

  @@index([email, name])
}

model Invoice {
  id              String            @id @default(cuid())
  customerId      String
  entityId        String
  invoiceNumber   String            @unique
  invoiceDate     DateTime
  dueDate         DateTime
  paymentTerms    String
  currency        String
  subtotal        Int
  tax             Int
  total           Int
  notes           String?
  status          InvoiceStatus     @default(Pending)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now()) @updatedAt
  customer        Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
  entity          Entity            @relation(fields: [entityId], references: [id], onDelete: Cascade)
  paymentReceived PaymentReceived[]
  invoiceItem     InvoiceItem[]
  activities      InvoiceActivity[]

  @@index([invoiceNumber, customerId, currency])
}

model InvoiceActivity {
  id           String              @id @default(cuid())
  invoiceId    String
  invoice      Invoice             @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  activityType InvoiceActivityType
  description  String
  performedBy  String?
  metadata     Json?
  createdAt    DateTime            @default(now())

  @@index([invoiceId, createdAt])
  @@index([invoiceId])
}

model InvoiceItem {
  id        String    @id @default(cuid())
  itemId    String
  item      Items     @relation(fields: [itemId], references: [id])
  rate      Int
  quantity  Int
  total     Int
  invoiceId String
  invoice   Invoice   @relation(fields: [invoiceId], references: [id])
  createdAt DateTime  @default(now())
  updateAt  DateTime?

  @@index([itemId])
}

model PaymentMade {
  id            String            @id @default(cuid())
  vendorId      String
  vendor        vendor            @relation(fields: [vendorId], references: [id])
  billNumber    String?
  paymentDate   DateTime
  amount        String
  paymentMethod PaymentMethod
  entityId      String
  entity        Entity            @relation(fields: [entityId], references: [id])
  accountId     String
  account       Account           @relation(fields: [accountId], references: [id])
  reference     String?
  note          String?
  status        PaymentMadeStatus @default(Pending)

  @@index([entityId])
}

model vendor {
  id            String        @id @default(cuid())
  name          String
  type          String
  displayName   String
  taxId         String
  website       String?
  companyName   String
  jobTitle      String
  email         String
  phone         String
  city          String
  province      String
  postalCode    String
  country       String
  paymentTerms  String
  currency      String
  accountNumber String
  creditLimit   String
  bankName      String
  accountName   String
  entityId      String
  routingNumber String?
  internalNote  String?
  status        vendorStatus  @default(Active)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  bills         Bills[]
  entity        Entity        @relation(fields: [entityId], references: [id], onDelete: Cascade)
  expenses      Expenses[]
  paymentMade   PaymentMade[]

  @@unique([email, phone])
  @@index([email, entityId])
  @@index([type, email])
}

model PaymentReceived {
  id            String                @id @default(cuid())
  invoiceId     String
  amount        Int
  total         Int
  paidAt        DateTime
  paymentMethod String
  depositTo     String
  reference     String
  note          String?
  status        PaymentReceivedStatus @default(Pending)
  entityId      String
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @default(now()) @updatedAt
  entity        Entity                @relation(fields: [entityId], references: [id], onDelete: Cascade)
  invoice       Invoice               @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  account       Account               @relation(fields: [depositTo], references: [id], onDelete: Restrict)

  @@index([invoiceId])
}

model Expenses {
  id               String        @id @default(cuid())
  date             DateTime
  reference        String
  vendorId         String?
  vendor           vendor?       @relation(fields: [vendorId], references: [id], onDelete: SetNull)
  paymentMethod    PaymentMethod
  paymentAccountId String
  paymentAccount   Account       @relation("PaymentAccount", fields: [paymentAccountId], references: [id], onDelete: Restrict)
  expenseAccountId String
  expenseAccount   Account       @relation("ExpenseAccount", fields: [expenseAccountId], references: [id], onDelete: Restrict)
  amount           Int
  tax              String
  description      String?
  status           ExpenseStatus @default(pending)
  tags             String[]
  attachment       Json?
  entityId         String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @default(now()) @updatedAt
  entity           Entity        @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@index([reference, paymentAccountId])
  @@index([reference, expenseAccountId])
}

model Bills {
  id            String          @id @default(cuid())
  billDate      DateTime
  billNumber    String?
  vendorId      String
  dueDate       DateTime
  poNumber      String?
  paymentTerms  String
  subtotal      Int
  tax           Int
  discount      Int
  total         Int
  category      String
  notes         String?
  attachment    Json?
  status        BillStatus      @default(unpaid)
  items         Json // Array of {name, rate, quantity, total, createdAt, updatedAt}
  entityId      String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now()) @updatedAt
  entity        Entity          @relation(fields: [entityId], references: [id], onDelete: Cascade)
  vendor        vendor          @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  paymentRecord PaymentRecord[]

  @@index([billDate, category])
}

model PaymentRecord {
  id            String              @id @default(uuid())
  billId        String
  paidAt        DateTime
  paymentMethod PaymentMethod
  reference     String
  account       String
  amount        Int
  note          String?
  status        paymentRecordStatus @default(cleared)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @default(now()) @updatedAt
  bill          Bills               @relation(fields: [billId], references: [id], onDelete: Cascade)

  @@index([billId])
}

model Receipt {
  id            String        @id @default(cuid())
  date          DateTime
  entityId      String
  paymentMethod PaymentMethod
  subtotal      Int
  tax           Int
  total         Int
  status        ReceiptStatus @default(Void)
  createdAt     DateTime      @default(now())
  customerId    String
  receiptNumber String        @default("123456789")
  updatedAt     DateTime      @default(now()) @updatedAt
  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  entity        Entity        @relation(fields: [entityId], references: [id], onDelete: Cascade)

  receiptItem ReceiptItem[]

  @@index([date])
}

model ReceiptItem {
  id        String   @id @default(cuid())
  itemId    String
  item      Items    @relation(fields: [itemId], references: [id])
  quantity  Int
  rate      Int
  total     Int
  receiptId String
  receipt   Receipt  @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([receiptId])
  @@index([itemId])
}

model Items {
  id             String           @id @default(cuid())
  name           String
  category       String
  sku            String?
  unit           String?
  description    String
  sellingPrice   Int?
  costPrice      Int?
  rate           Int?
  taxable        Boolean          @default(false)
  currentStock   Int?
  lowStock       Int?
  type           ItemsType        @default(product)
  trackInventory Boolean          @default(false)
  sellOnline     Boolean          @default(false)
  entityId       String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now()) @updatedAt
  entity         Entity           @relation(fields: [entityId], references: [id], onDelete: Cascade)
  invoiceItem    InvoiceItem[]
  receiptItems   ReceiptItem[]
  collections    CollectionItem[]

  @@index([entityId, type])
}

model Collection {
  id          String           @id @default(cuid())
  name        String
  slug        String
  image       Json?
  description String
  visibility  Boolean          @default(false)
  featured    Boolean          @default(false)
  entityId    String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @default(now()) @updatedAt
  entity      Entity           @relation(fields: [entityId], references: [id], onDelete: Cascade)
  items       CollectionItem[]

  @@unique([slug, entityId])
  @@index([entityId])
}

model CollectionItem {
  id           String     @id @default(cuid())
  collectionId String
  itemId       String
  sortOrder    Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @default(now()) @updatedAt
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  item         Items      @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@unique([collectionId, itemId])
  @@index([collectionId])
  @@index([itemId])
}

model Asset {
  id                 String      @id @default(cuid())
  name               String
  type               String
  department         String
  assigned           String
  description        String
  purchaseDate       DateTime
  purchaseCost       Int
  currentValue       Int
  expiryDate         DateTime
  trackDepreciation  Boolean     @default(false)
  depreciationMethod String
  years              Int
  salvageValue       Int
  activeAsset        Boolean     @default(false)
  status             AssetStatus @default(in_use)
  entityId           String
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @default(now()) @updatedAt
  entity             Entity      @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@index([id, entityId])
}

model AccountType {
  id          String            @id @default(cuid())
  code        String            @unique
  name        String
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @default(now()) @updatedAt
  categories  AccountCategory[]
}

model AccountCategory {
  id            String               @id @default(cuid())
  code          String
  name          String
  description   String?
  groupId       String
  typeId        String
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @default(now()) @updatedAt
  group         Group                @relation(fields: [groupId], references: [id], onDelete: Cascade)
  type          AccountType          @relation(fields: [typeId], references: [id])
  subCategories AccountSubCategory[]

  @@unique([code, groupId])
  @@index([groupId, typeId])
}

model AccountSubCategory {
  id          String          @id @default(cuid())
  code        String
  name        String
  description String?
  categoryId  String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now()) @updatedAt
  category    AccountCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  accounts    Account[]

  @@unique([code, categoryId])
  @@index([categoryId])
}

model Account {
  id              String             @id @default(cuid())
  name            String
  code            String
  description     String
  entityId        String
  subCategoryId   String
  balance         Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @default(now()) @updatedAt
  entity          Entity             @relation(fields: [entityId], references: [id], onDelete: Cascade)
  subCategory     AccountSubCategory @relation(fields: [subCategoryId], references: [id])
  budget          Budget[]
  paymentReceived PaymentReceived[]
  paymentMade     PaymentMade[]
  bankAccount     BankAccount?       @relation("LinkedBankAccount")
  expenseAccount  Expenses[]         @relation("ExpenseAccount")
  paymentAccount  Expenses[]         @relation("PaymentAccount")

  @@index([id, entityId])
  @@index([subCategoryId])
}

model Journal {
  id          String   @id @default(cuid())
  description String
  date        DateTime
  lines       Json
  reference   String
  entityId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
  entity      Entity   @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@index([id, entityId])
}

model Budget {
  id         String   @id @default(cuid())
  name       String
  amount     Int
  periodType String
  month      String
  fiscalYear String
  note       String?
  accountId  String
  entityId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
  account    Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  entity     Entity   @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@index([entityId])
}

model Employee {
  id               String         @id @default(cuid())
  firstName        String
  lastName         String
  email            String         @unique
  phoneNumber      String
  dateOfBirth      DateTime
  employeeId       String         @unique
  department       String
  position         String
  profileImage     Json?
  employmentType   String
  dateOfHire       DateTime
  reportingManager String
  anualLeave       Int
  salary           Int
  allowances       Int
  perFrequency     String
  currency         String
  bankName         String
  acountType       String
  accountNumber    String
  routingNumber    String
  addressInfo      Json?
  emergencyContact Json?
  note             String?
  asdraft          Boolean        @default(false)
  entityId         String
  createdAt        DateTime       @default(now())
  status           EmployeeStatus @default(Active)
  updatedAt        DateTime       @default(now()) @updatedAt
  attendance       Attendance[]
  entity           Entity         @relation(fields: [entityId], references: [id], onDelete: Cascade)
  leave            Leave[]

  @@index([employeeId, email, entityId])
}

model AttendanceLog {
  id          String       @id @default(cuid())
  date        DateTime
  entityId    String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  attendances Attendance[]
  entity      Entity       @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@unique([date, entityId])
  @@index([date, entityId])
}

model Attendance {
  id              String        @id @default(cuid())
  employeeId      String
  status          String
  checkInTime     DateTime?
  checkOutTime    DateTime?
  notes           String?
  asdraft         Boolean       @default(false)
  entityId        String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  attendanceLogId String
  attendanceLog   AttendanceLog @relation(fields: [attendanceLogId], references: [id], onDelete: Cascade)
  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId, entityId])
  @@index([attendanceLogId])
}

model Leave {
  id               String      @id @default(cuid())
  employeeId       String
  leaveType        String
  days             Int
  startDate        DateTime
  endDate          DateTime
  reason           String
  entityId         String
  status           LeaveStatus @default(Pending)
  contact          String
  emergencyContact String
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @default(now()) @updatedAt
  employee         Employee    @relation(fields: [employeeId], references: [id])
  entity           Entity      @relation(fields: [entityId], references: [id])

  @@index([employeeId, status])
}

model Permission {
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now()) @updatedAt
  groupRoles  GroupRole[] @relation("GroupRoleToPermission")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  ipAddress String?  @map("ip_address")
  device    String?
  location  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model BankAccount {
  id              String            @id @default(cuid())
  accountName     String
  bankName        String
  accountType     String
  currency        String
  accountNumber   String            @unique
  routingNumber   String?
  openingBalance  Int               @default(0)
  currentBalance  Int               @default(0)
  status          BankAccountStatus @default(active)
  linkedAccountId String            @unique
  entityId        String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now()) @updatedAt
  entity          Entity            @relation("BankAccounts", fields: [entityId], references: [id], onDelete: Cascade)
  linkedAccount   Account           @relation("LinkedBankAccount", fields: [linkedAccountId], references: [id])
  transactions    BankTransaction[]

  @@index([entityId, linkedAccountId])
  @@index([accountNumber])
}

model BankTransaction {
  id            String                @id @default(cuid())
  date          DateTime
  description   String
  category      String?
  amount        Int
  type          BankTransactionType
  reference     String?
  status        BankTransactionStatus @default(pending)
  metadata      Json?
  bankAccountId String
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @default(now()) @updatedAt
  bankAccount   BankAccount           @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)

  @@index([bankAccountId, date])
  @@index([date])
}

enum BillingCycle {
  Monthly
  Annual
}

enum PaymentMadeStatus {
  Pending
  Cleared
}

enum systemRole {
  superadmin
  admin
  user
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
}

enum PaymentReceivedStatus {
  Paid
  Pending
  Partial
}

enum EmployeeStatus {
  Active
  Inactive
  On_Leave
}

enum AssetStatus {
  in_use
  in_storage
}

enum paymentRecordStatus {
  pending
  cleared
}

enum ItemsType {
  product
  service
}

enum BillStatus {
  paid
  unpaid
  partial
  pending
}

enum vendorStatus {
  Active
  Inactive
}

enum ExpenseStatus {
  pending
  draft
  approved
  rejected
}

enum PaymentMethod {
  Cash
  Card
  Bank_Transfer
  Mobile_Money
  Check
  Debit_Card
  Credit_Card
  ACH
  Wire_Transfer
}

enum ReceiptStatus {
  Completed
  Void
}

enum InvoiceStatus {
  Overdue
  Paid
  Draft
  Sent
  Pending
  Partial
}

enum InvoiceActivityType {
  Created
  Sent
  Viewed
  PaymentReceived
  Overdue
  Cancelled
  Updated
}

enum BankAccountStatus {
  active
  inactive
  closed
}

enum BankTransactionType {
  credit
  debit
}

enum BankTransactionStatus {
  pending
  cleared
  reconciled
  reversed
}
